// app-router-fix.js
// This script modifies the project to work with App Router and avoid any Page Router conflicts

const fs = require('fs');
const path = require('path');

console.log('Starting App Router compatibility fix...');

// Create empty pages directory to inform Next.js we're NOT using the Pages Router
// but prevent warnings about missing directories
const pagesDir = path.join(process.cwd(), 'pages');
if (!fs.existsSync(pagesDir)) {
  console.log('Creating empty pages directory...');
  fs.mkdirSync(pagesDir);
  
  // Create minimal files to avoid errors but ensure they don't actually do anything
  fs.writeFileSync(
    path.join(pagesDir, '_app.js'),
    `// Empty app file to avoid Pages Router conflicts
import React from 'react';
export default function App({ Component, pageProps }) {
  return <Component {...pageProps} />;
}
`
  );
  
  // Create a dummy 404 page
  fs.writeFileSync(
    path.join(pagesDir, '404.js'),
    `// Empty 404 page to avoid Pages Router conflicts
import React from 'react';
export default function Custom404() {
  return <div>Not Found</div>;
}
`
  );
}

// Ensure the app directory exists and create a minimal test page
const appDir = path.join(process.cwd(), 'app');
if (!fs.existsSync(appDir)) {
  fs.mkdirSync(appDir);
}

// Create a test page to verify App Router is working
const testAppDir = path.join(appDir, 'test-app-router');
if (!fs.existsSync(testAppDir)) {
  fs.mkdirSync(testAppDir);
  
  fs.writeFileSync(
    path.join(testAppDir, 'page.js'),
    `// Test App Router page
export default function TestAppRouterPage() {
  return (
    <div>
      <h1>App Router is working!</h1>
      <p>This page was generated by the App Router compatibility fix script.</p>
    </div>
  );
}
`
  );
}

// Create a simplified next.config.js
const nextConfigPath = path.join(process.cwd(), 'next.config.js');
console.log('Creating simplified next.config.js...');
fs.writeFileSync(
  nextConfigPath,
  `/** @type {import('next').NextConfig} */
const nextConfig = {
  // Environment variables
  env: {
    NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,
    NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
  },
  // Basic settings
  reactStrictMode: true,
  poweredByHeader: false,
  swcMinify: false,
  
  // App Router configuration - for Next.js 13.4+
  experimental: {
    appDir: true,
  },
  
  // Disable type checking during build
  typescript: {
    ignoreBuildErrors: true,
  },
  eslint: {
    ignoreDuringBuilds: true,
  },
  
  // Simplified image config
  images: {
    unoptimized: true,
    domains: ['*'],
  },
};

module.exports = nextConfig;
`
);

console.log('App Router compatibility fix completed successfully!'); 